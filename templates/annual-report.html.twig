{#
/**
 * @file
 * Theme template for the Annual Data In Review.
 */
#}
<div class="annual-report-container">
  <header class="annual-report-header">
    <div class="header-content">
      <div class="lead">{{ description }}</div>
      {% if notice %}
        <div class="annual-report-notice">
          {{ notice }}
        </div>
      {% endif %}
    </div>
  </header>

  {% if highlights %}
    <section class="annual-report-section highlights-section">
      <h2>{{ 'Key Highlights'|t }}</h2>
      <ul class="highlights-list">
        {% for highlight in highlights %}
          <li>{{ highlight|raw }}</li>
        {% endfor %}
      </ul>
    </section>
  {% endif %}

  <section class="annual-report-section">
    <h2>{{ 'Year-over-Year Comparison'|t }}</h2>
    <div class="metric-grid">
      {% for row in rows %}
        <div class="metric-card">
          <div class="metric-label">{{ row.label }}</div>
          <div class="metric-value">{{ row.current }}</div>
          <div class="metric-trend {{ row.trend_class }}">
            {{ row.change }} ({{ row.percent }})
          </div>
          <div class="small text-muted mt-1">{{ 'Prev: ' ~ row.previous }}</div>
        </div>
      {% endfor %}
    </div>
  </section>

  {% if tables %}
    <section class="annual-report-section">
      {% for table_key, table_group in tables %}
        <details class="report-section" open>
          <summary>{{ table_group['#title'] }}</summary>
          <div class="report-section__content">
            {{ table_group.table }}
          </div>
        </details>
      {% endfor %}
    </section>
  {% endif %}

  {% if charts %}
    <div class="charts-container">
      {% for group_key, group in charts %}
        {% if group|length > 3 %} {# Simple check if group has content (properties + children) #}
          <section class="annual-report-section report-group group-{{ group_key }}">
            <h2>{{ group['#title'] }}</h2>
            <div class="chart-grid">
              {% for key, item in group %}
                {% if item.chart %}
                  <div class="annual-report-card">
                    <div class="card-header">
                      <h3>{{ item['#title'] }}</h3>
                    </div>
                    <div class="card-body">
                      {{ item.chart }}
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </section>
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}
</div>
